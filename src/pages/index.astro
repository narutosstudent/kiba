---
import MySiteLayout from '../layouts/MySiteLayout.astro'
import { Trailer, Navigation } from '../components/home'
import {
  MovieSchema,
  MovieWithTrailerImageSchema,
  ResponseSchema,
} from '../lib/schemas'

function getAssetURL(assetId: string) {
  return `${ENDPOINT}/assets/${assetId}?access_token=${TOKEN}`
}

const ENDPOINT = import.meta.env.ENDPOINT
const TOKEN = import.meta.env.TOKEN

const response = await fetch(`${ENDPOINT}/items/movies?access_token=${TOKEN}`)
const data = ResponseSchema.parse(await response.json()).data

const firstMovie = MovieSchema.parse(data[0])

const trailerMovie = MovieWithTrailerImageSchema.parse({
  ...firstMovie,
  trailerUrl: getAssetURL(firstMovie.trailer),
  imageUrl: getAssetURL(firstMovie.image),
})
---

<MySiteLayout>
  <Navigation client:load />
  <Trailer client:load movie={trailerMovie} />
</MySiteLayout>
